<p id="notice"><%= notice %></p>

<p>
  <strong>Finder:</strong>
  <%= User.find(@match.finder_id).email %>
</p>

<p>
  <strong>Target:</strong>
  <%= User.find(@match.target_id).email %>
</p>
<div id="radar"></div>
<script>
var level = "To be updated"
function request_distance(){
  if (navigator.geolocation) {
    var timeoutVal = 10 * 1000 * 1000;
    navigator.geolocation.getCurrentPosition(
      find_distance, 
      displayError,
      { enableHighAccuracy: true, timeout: timeoutVal, maximumAge: 0 }
    );
  } 
  else {
    alert("Geolocation is not supported by this browser");
  }
}

function displayError(error) {
 var errors = { 
   1: 'Permission denied',
   2: 'Position unavailable',
   3: 'Request timeout'
 };
 alert("Error: " + errors[error.code]);
}

function find_distance(position){
  $.ajax({
          url : "<%= get_distance_match_path %>",
          type : "post",
          data : { 
              x_coord: position.coords.latitude, 
              y_coord: position.coords.longitude},
          success : function(data){
            if (data.level !== null )
            {
              level = data.level
            }
            $("#radar").text(data.distance + ":" + level);
          },
          error : function(){
            $("#radar").text("Could not connect to server")
          }
  });
};

setInterval(function(){request_distance()}, 3000);
</script>

<%= link_to 'Edit', edit_match_path(@match) %> |
<%= link_to 'Back', matches_path %>
